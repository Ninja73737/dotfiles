#! /usr/bin/env bash

# X Configuration

$HOME/.scripts/display_setup

xinput --set-prop "Corsair CORSAIR HARPOON RGB WIRELESS Gaming Dongle" "libinput Accel Profile Enabled" 0, 1

# Set display DPMS blanking time
xset s 1800

# Set mouse sensitivity, has some issues but I forgot what the issues are...
# sensitivity_factor=1.25
# xinput set-prop "Corsair CORSAIR HARPOON RGB WIRELESS Gaming Dongle" "Coordinate Transformation Matrix" $sensitivity_factor 0 0 0 $sensitivity_factor 0 0 0 1

# BSPWM Settings

case $HOSTNAME in
  horizon)
    bspc monitor HDMI-0 -d 1 2 3 4 5
    bspc monitor DVI-D-0 -d 6 7 8 9
    bspc monitor HDMI-0 -s DVI-D-0
    ;;
  arch-air)
    bspc monitor eDP1 -d 1 2 3 4 5 6 7 8 9 0
    xmodmap $HOME/.config/Xmodmap/laptop
    ;;
esac

bspc config focus_follows_pointer   true
bspc config pointer_follows_focus   true
bspc config pointer_follows_monitor true
bspc config top_padding             0
bspc config border_width            0
bspc config window_gap              16
bspc config pointer_modifier        mod1
bspc config pointer_action1         move
bspc config pointer_action2         resize_side

bspc config split_ratio             0.5
bspc config borderless_monocle      true
bspc config gapless_monocle         true
bspc config single_monocle          true

# BSPWM Rules

bspc rule -r "*"

bspc rule -a Gimp state=floating follow=on
bspc rule -a Zathura state=tiled
bspc rule -a Bitwarden state=floating

# Autostart Services

# Because it can't handle the tray disappearing for a few seconds
killall -q aw-qt

$HOME/.config/polybar/launch.sh

pgrep sxhkd || sxhkd &
pgrep picom || picom --experimental-backends &
pgrep flashfocus || flashfocus &
pgrep dunst || $HOME/.config/dunst/launch.sh
pgrep blueberry-tray || blueberry-tray
pgrep agent || /usr/lib/geoclue-2.0/demos/agent &
pgrep redshift || redshift &
pgrep mailspring || mailspring --background &
which discord && (pgrep Discord || discord &) || which discord-canary && (pgrep DiscordCanary || discord-canary &)
pgrep spotify || spotify &
pgrep redshift || redshift &

bash -c "while pgrep -u $UID -x aw-qt > /dev/null; do sleep 0.1; done; sleep 5; aw-qt" &

# Recover Wallpaper and Theme

fish -c "sleep 1; wal -R" &
