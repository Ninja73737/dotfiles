#! /usr/bin/env fish

xset s 1800

# BSPWM Settings

bspc config focus_follows_pointer     true
bspc config pointer_follows_focus     true
bspc config pointer_follows_monitor   true

bspc config top_padding               -16
bspc config left_padding              -16
bspc config right_padding             -16
bspc config bottom_padding            -16
bspc config border_width              0
bspc config window_gap                16

bspc config pointer_modifier          mod4
bspc config pointer_action1           move
bspc config pointer_action2           resize_side

bspc config split_ratio               0.5

bspc config borderless_monocle        true
bspc config gapless_monocle           false
bspc config single_monocle            true

bspc config ignore_ewmh_struts        true
bspc config honor_size_hints          true
bspc config remove_disabled_monitors  true
bspc config remove_unplugged_monitors true

switch (cat /etc/hostname)
  case horizon
    $HOME/.scripts/screenlayout/desktop_dual_ultrawide
    bspc monitor DP-4 -d 1 2 3 4 5
    bspc monitor HDMI-0 -d 6 7 8 9
  case air
    bspc monitor eDP1 -d 2 3 5 6 8 9
    fish -c "pgrep kmonad || kmonad $HOME/.config/kmonad/laptop_mods.kbd" &
    libinput-gestures-setup start
  case zephyrus
    if xrandr | grep "HDMI-1 connected"
      $HOME/.scripts/screenlayout/hdmi_ultrawide_laptop
      bspc monitor -o HDMI-1 eDP-1
      bspc monitor HDMI-1 -d 1 2 3 4 5
      bspc monitor eDP-1 -d 6 7 8 9
    else if lsusb -d 2109:8817
      $HOME/.scripts/screenlayout/laptop_usbc_dual_ultrawide
      bspc monitor -o %DP-0.3 %DP-0.2 eDP-1-1
      for i in (seq 1 3)
          bspc desktop "^$i" -m %DP-0.3
      end
      bspc monitor %DP-0.3 -d 1 2 3
      for i in (seq 4 6)
          bspc desktop "^$i" -m %DP-0.2
      end
      bspc monitor %DP-0.2 -d 4 5 6
      for i in (seq 7 9)
          bspc desktop "^$i" -m eDP-1-1
      end
      bspc monitor eDP-1-1 -d 7 8 9
    else
      $HOME/.scripts/screenlayout/laptop
      if xrandr | grep "eDP-1 "
        for i in (seq 1 9)
            bspc desktop "^$i" -m eDP-1
        end
        bspc monitor eDP-1 -d 1 2 3 4 5 6 7 8 9
      else
        for i in (seq 1 9)
            bspc desktop "^$i" -m eDP-1-1
        end
        bspc monitor eDP-1-1 -d 1 2 3 4 5 6 7 8 9
      end
      for monitor in (bspc query -M --names)
        if ! string match 'eDP-1*' "$monitor"
          bspc monitor "%$monitor" -r
        end
      end
    end
    fish -c "pgrep kmonad || kmonad $HOME/.config/kmonad/laptop_mods.kbd" &
end

# BSPWM Rules

bspc rule -r "*"

bspc rule -a Zathura state=tiled
bspc rule -a Bitwarden state=floating

# Autostart Services

wal -R &

$HOME/.config/polybar/launch.sh &

switch (cat /etc/hostname)
  case horizon
    pgrep sxhkd && pkill -USR1 -x sxhkd || sxhkd &
  case air
    pgrep sxhkd && pkill -USR1 -x sxhkd || sxhkd &
  case zephyrus
    pgrep sxhkd && pkill -USR1 -x sxhkd || sxhkd -c $HOME/.config/sxhkd/sxhkdrc $HOME/.config/sxhkd/g14 &
end
pgrep dunst || $HOME/.config/dunst/launch.sh &
$HOME/.scripts/start_apps
